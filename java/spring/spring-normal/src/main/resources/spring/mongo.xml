<?xml version="1.0" encoding="UTF-8"?>
<!--suppress SpringFacetInspection -->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mongo="http://www.springframework.org/schema/data/mongo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.0.xsd
    http://www.springframework.org/schema/data/mongo
    http://www.springframework.org/schema/data/mongo/spring-mongo.xsd">

  <context:property-placeholder location="classpath:mongo.properties"/>

  <mongo:mongo-client id="mongoClient" host="${mongo.host}" port="${mongo.port}" credentials="${mongo.credentials}">
    <mongo:client-options max-wait-time="3000"/>
  </mongo:mongo-client>

  <bean id="mongoDbFactory" class="org.springframework.data.mongodb.core.SimpleMongoDbFactory">
    <constructor-arg name="mongo" ref="mongoClient"/>
    <constructor-arg name="databaseName" value="${mongo.database}"/>
  </bean>

  <bean id="mappingContext" class="org.springframework.data.mongodb.core.mapping.MongoMappingContext"/>

  <!-- avoid '_class' key -->
  <bean id="defaultMongoTypeMapper" class="org.springframework.data.mongodb.core.convert.DefaultMongoTypeMapper">
    <constructor-arg name="typeKey">
      <null/>
    </constructor-arg>
  </bean>

  <bean id="mappingMongoConverter" class="org.springframework.data.mongodb.core.convert.MappingMongoConverter">
    <constructor-arg name="mongoDbFactory" ref="mongoDbFactory"/>
    <constructor-arg name="mappingContext" ref="mappingContext"/>
    <property name="typeMapper" ref="defaultMongoTypeMapper"/>
    <!--<property name="customConversions" ref="conversions"/>-->
  </bean>

  <bean id="conversions" class="org.springframework.data.mongodb.core.convert.CustomConversions">
    <constructor-arg>
      <list>
        <!--<bean class="com.asiafrank.mongodb.example3.converter.LocalDateTimeToDateConverter"/>-->
        <!--<bean class="com.asiafrank.mongodb.example3.converter.DateToLocalDateTimeConverter"/>-->
      </list>
    </constructor-arg>
  </bean>

  <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
    <constructor-arg name="mongoDbFactory" ref="mongoDbFactory"/>
    <constructor-arg name="mongoConverter" ref="mappingMongoConverter"/>
  </bean>

  <bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/>

  <mongo:auditing mapping-context-ref="mappingContext"/>

  <mongo:repositories base-package="com.asiafrank.learn.spring.repo"
                      mongo-template-ref="mongoTemplate"
                      base-class="com.asiafrank.learn.spring.repo.impl.BaseRepoImpl"
                      factory-class="com.asiafrank.learn.spring.repo.BaseRepoFactoryBean"
                      repository-impl-postfix="Impl"/>

  <context:annotation-config/>
  <context:component-scan base-package="com.asiafrank.learn.spring.bo.impl"/>
</beans>